 <?php
    include("app_functions2.php");
    $dataChat = RecentChatDiscussion(" where _to = '-999' or _to = ''", "13") ;
        $dataDiscussion   =  RecentUserDiscussionThread();
        $dataDiscussionOther = DiscussionThreadForOthers();
    $dataChatOnline = Online_User_List();
     
    
 
    
?>
 <?php 
    if ($_REQUEST['ver'] == "")
        $replystyle = "display:none"; 
    else
        $replystyle = "color:#428bca;float:right"; 
    $session_name = CheckUserName();
     
     function AddFriend($session_id,$position)
     {
    
         $acceptSent = Online_User_History("Select accept from tbl_app_contacts where friend_session_id   = '". $session_id."' and session_id = '".$_REQUEST['session_id']."'","1");
         if ($acceptSent != "2") {  
             $accept = Online_User_History("Select accept from tbl_app_contacts where session_id  = '". $session_id."' and friend_session_id = '".$_REQUEST['session_id']."'","1");
             
             if ($accept == "2") {
                 echo '<a  style="float:'.$position.'" class="ancAddFriend-'.$session_id.'" onclick="javascript:FriendRequest(\''.$session_id.'\',1)"><i class="icon-signal"></i>Confirm Friend</a>';
                 
             }
             else if ($accept == "1") {
               echo '<a  style="float:'.$position.'" class="ancAddFriend-'.$session_id.'" onclick="javascript:FriendRequest(\''.$session_id.'\',0)"><i class="icon-signal"></i>Delete Friend</a>';
                
                 
                 
             }
             else
             {
                 echo '<a  style="float:'.$position.'" class="ancAddFriend-'.$session_id.'" onclick="javascript:FriendRequest(\''.$session_id.'\',2)"><i class="icon-signal"></i>Add Friend</a>';
             }
         }   
         else
         {
               echo '<a  style="float:'.$position.'" class="ancAddFriend-'.$session_id.'" ><i class="icon-signal"></i>Friend Request Already Sent</a>';
         }
         
     }
   ?> 
<head>
    <link href="css/main.css" rel="stylesheet">
        <script>
            function doFirst(){
                articles = document.getElementsByClassName('replydiscussion');
                for (var i = 0; i < articles.length; i++) {
                    articles[i].onclick = function() {
                        
                        var id = "discussionreply-" + this.getAttribute("data-brand");
                        document.getElementById(id).style.display="block";
                        
                                                
                        
                        
                    }
                }
            }
            function SendDiscussion(id)
            {
                var chat =   document.getElementById("txtdiscussionreply-"+id).value;
                if (chat == "") return;
                
                var to =   id;
                var chatter  =   document.getElementById("chatter").value;
                var _frm =   document.getElementById("session_id").value;
                if (_frm == "123456789") 
                {
                    alert("Demo account doesn't have rights to reply. Please register yourself");
                    return;
                }         
                
                
                var xmlhttp;
                if (window.XMLHttpRequest)
                {// code for IE7+, Firefox, Chrome, Opera, Safari
                    xmlhttp=new XMLHttpRequest();
                }
                else
                {// code for IE6, IE5
                    xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
                }
                xmlhttp.onreadystatechange=function()
                    {
                        if (xmlhttp.readyState==4 && xmlhttp.status==200)
                        {
                            if (id == "-999")
                            {
                                location.reload();
                            }
                            else
                            {
                                
                            }
                            //response
                            // document.getElementById("myDiv").innerHTML=xmlhttp.responseText;
                        }
                    }
                xmlhttp.open("POST","pp_chat2.php",true);
                xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
                xmlhttp.send("chat="+chat+"&_frm="+_frm + "&to="+to + "&chatter="+chatter);
                document.getElementById("txtdiscussionreply-"+id).disabled=true;
                document.getElementById("btndiscussionreply-"+id).style.display="none";
           
               
            }
            function FriendRequest(fSessionId,Accept)
            {
                //addFriend.php?session_id=&friend_session_id=&friend_name="
                
                var SessionId =   document.getElementById("session_id").value;
                var  articles = document.getElementsByClassName('ancAddFriend-'+ fSessionId);

                var xmlhttp;
                if (window.XMLHttpRequest)
                {// code for IE7+, Firefox, Chrome, Opera, Safari
                    xmlhttp=new XMLHttpRequest();
                }
                else
                {// code for IE6, IE5
                    xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
                }
                xmlhttp.onreadystatechange=function()
                    {
                        if (xmlhttp.readyState==4 && xmlhttp.status==200)
                        {
                            
                            for (var i = 0; i < articles.length; i++) {
                                articles[i].style.display="none";
                        
                               
                                
                            }
                        
                        }
                    }
                xmlhttp.open("POST","addFriend.php",true);
                xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
                xmlhttp.send("session_id="+SessionId+"&friend_session_id="+fSessionId+"&accept="+Accept);
               
           

            }
            
                
            </script>
    </head>
    <body onload="doFirst()" style="background:#f2f2f2">
        
        <input type="hidden" value="<?php echo $_REQUEST['session_id']; ?>" id="session_id"  >
        <input type="hidden" value="<?php echo $session_name; ?>" id="chatter" />
        
 <div class="dashboard-wrapper">
   
        <div class="main-container">
			 <?php  include("quickdataentry/quickdataentry_specialist_zipcode_contact.html"); ?>
		   
            <?php  if ($_REQUEST['ver'] == "") { ?>
            <B>Note: </b> <i>To do reply of any chat and discussion though here, So please <a href="https://play.google.com/store/apps/details?id=com.shifa.kent&hl=en" style="color:#428bca">update</a> shifa app now from play store   </i>
            <?php } ?>

               <div class="row-fluid">
            

            <div class="span12">
              <div class="widget">
                <div class="widget-header">
                  <div class="title">
                    <span class="fs1" aria-hidden="true" data-icon="?"></span> Recent Messages
                  </div>
                </div>
                  <?php if  ($_REQUEST['ver'] != "") { ?>
                   <form class="tweet-form no-margin">
                       <input type="text" id="txtdiscussionreply--999" class="input-block-level" rows="2" placeholder="@<?php echo $session_name; ?>: Reply here"></input>
                        <input id="btndiscussionreply--999" type="button" class="btn btn-info pull-right" value="Send" onclick="SendDiscussion(-999)">
                        <div class="clearfix"></div>
                                </form>
                  <?php } ?>
                <div class="widget-body">
                  <div id="scrollbar-two">
                    
                      <div class="viewport" style="height:477px">
                      <div class="overview">
                        <div id="chats">
                            <div style="height:564px;overflow:auto" class="tab-widget">
                            <ul class="chats">
                              <?php if ($dataChat) { ?>  
                              <?php foreach($dataChat as $value) { ?>
                              <li class="no-padding">
                                <div class="info no-margin">
                                    <img style="height: 25px;width: 25px;" src="shifa-fresh-homepage/<?php echo $value['icon']; ?>" alt="user">
									<img style="height: 15px;" src="sendcontactinfo/imgs/msgprivate.png" alt="user">
                                    <span class="name"><?php echo $value['chatter']; ?></span>: <small><?php echo $value['chat']; ?></small>
                                    <?php // Add Friend Code is ready just need to disable the comment  // echo AddFriend($value['session_id'],"Right"); ?>
									<?php // Send Contact Info   ?>
									
                                </div>
                              </li>
                           <? } ?>
                                <? } ?>
                            </ul>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

            
            
            
            
              <?php if  ($_REQUEST['ver'] != "") { ?>
          
            <div class="row-fluid">
            <div class="span12">
              <div class="widget">
                <div class="widget-header">
                  <div class="title">
                      <span class="fs1" aria-hidden="true" data-icon="?"></span> What's on your mind for discussion? <a style="color:red">(New)</a>
                  </div>
                </div>
                <div class="widget-body">
                                
              <form class="tweet-form no-margin">
                  <input type="text" id="txtdiscussionreply-0" class="input-block-level" rows="2" placeholder="Example: Weak memory causing alot of problem..."></input>
                        <input id="btndiscussionreply-0" type="button" class="btn btn-info pull-right" value="Send" onclick="SendDiscussion(0)">
                        <div class="clearfix"></div>
                                </form>
            
                </div>
              </div>
            </div>
          </div>
            <?php } ?>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <?php if ($dataDiscussion) { ?>
          <div class="row-fluid">
            <div class="span12">
              <div class="widget">
                <div class="widget-header">
                  <div class="title">
                    <span class="fs1" aria-hidden="true" data-icon="?"></span> Your Recent Discussion
                  </div>
                </div>
                <div class="widget-body">
                  <ul class="tweets tweet-group">
                      <?php if ($dataDiscussion) { ?>  
                   <?php foreach($dataDiscussion as $value) { ?>
                    <li class="in">
                        
                      <div class="message no-margin">
                          <img class="avatar" style="height: 25px;width: 25px;" alt="" src="shifa-fresh-homepage/<?php echo $value['icon']; ?>">
                        <div>
                            <p class="no-margin"><span  class="name"><?php echo $value['chatter']; ?></span>: <span class="designation"><?php echo $value['chat']; ?></span></p><small>at <?php echo $value['time']; ?></small>
                        </div>
                        <p class="body no-margin">
                         
                        </p>
                        <div class="clearfix"></div>
                      </div>
                    </li>
                      <?php if ($value['reply']) { ?>
                   <?php foreach($value['reply'] as $valuereply) { ?>
                    <li class="out">
                      <div class="message no-margin">
                         <img class="avatar"  style="height: 25px;width: 25px;" alt="" src="shifa-fresh-homepage/<?php echo $valuereply['icon']; ?>">

                        <span class="up-arrow"></span>
                        <span class="arrow"></span>
                          <p class="no-margin"><span  class="name">@<?php echo $valuereply['chatter']; ?></span>: <span  class="designation"><?php echo $valuereply['chat']; ?></span></p><small class="date-time"> at <?php echo $valuereply['time']; ?></small>
                      </div>
                    </li>
                      <?php } ?>
                      <? } } } ?>
                  </ul>
                </div>
              </div>
            </div>
          </div>
            <? }  ?>
          
          
          

          <div class="row-fluid">
            <div class="span12">
              <div class="widget">
                <div class="widget-header">
                  <div class="title">
                    <span class="fs1" aria-hidden="true" data-icon="?"></span> Recent Discussion
                  </div>
                </div>
                <div class="widget-body">
                  <ul class="tweets tweet-group">
                      <?php if ($dataDiscussionOther) { ?>  
                   <?php foreach($dataDiscussionOther as $value) {?>
                    <li class="in">
                        
                      <div class="message no-margin">
                          <img class="avatar" style="height: 25px;width: 25px;" alt="" src="shifa-fresh-homepage/<?php echo $value['icon']; ?>">
                        <div>
                            <p class="no-margin"><span  class="name"><?php echo $value['chatter']; ?></span>: <span class="designation"><?php echo $value['chat']; ?></span> <small>
                                
                                <span style="<?php echo $replystyle; ?>" class="replydiscussion" data-brand="<?php echo $value['_id']; ?>" >Reply</span>
                             
                                </small></p>
                               
                            <?php  // Add Friend Code is ready just need to disable the comment  //echo AddFriend($value['session_id'],"Left"); ?>
                            <div id="discussionreply-<?php echo $value['_id']; ?>" style="display:none"> <form class="tweet-form no-margin">
                        <input type="text" id="txtdiscussionreply-<?php echo $value['_id']; ?>" class="input-block-level" rows="2" placeholder="Reply to @<?php echo $value['chatter']; ?>"></input>
                        <input id="btndiscussionreply-<?php echo $value['_id']; ?>" type="button" class="btn btn-info pull-right" value="Send" onclick="SendDiscussion(<?php echo $value['_id']; ?>)">
                        <div class="clearfix"></div>
                                </form></div>
                        </div>
                        <p class="body no-margin">
                         
                        </p>
                        <div class="clearfix"></div>
                      </div>
                    </li>
                      
                   <?php 
if ($value['reply'] ) {
foreach($value['reply'] as $valuereply) { ?>
                    <li class="out">
                      <div class="message no-margin">
                         <img class="avatar"  style="height: 25px;width: 25px;" alt="" src="shifa-fresh-homepage/<?php echo $valuereply['icon']; ?>">
                          <?php // Add Friend Code is ready just need to disable the comment  // echo AddFriend($valuereply['session_id'],"Right"); ?>
                        <span class="up-arrow"></span>
                        <span class="arrow"></span>
                          <p class="no-margin"><span  class="name">@<?php echo $valuereply['chatter']; ?></span> (<?php echo   Online_User_History("Select count(*) from tbl_app_chat where _frm = '". $valuereply['session_id']."'","1"); ?>): <span  class="designation"><?php echo $valuereply['chat']; ?></span></p><small class="date-time"> at <?php echo $valuereply['time']; ?></small>
                      </div>
                    </li>
                      <? } } } } ?>
                  </ul>
                </div>
              </div>
            </div>
          </div>

     
          
          
          
          <div class="row-fluid">
            

            <div class="span4">
              <div class="widget">
                <div class="widget-header">
                  <div class="title">
                    <span class="fs1" aria-hidden="true" data-icon="?"></span> Recent Login
                  </div>
                </div>
                <div class="widget-body">
                  <div class="tab-widget">
                    <ul class="signups">
                    <?php if ($dataChatOnline) { 
                    foreach($dataChatOnline as $value){ ?>
                      <li class="no-padding">
                       
                        <div class="no-margin">
                            <p class="no-margin"><img style="height: 25px;width: 25px;" src="shifa-fresh-homepage/<?php echo $value['icon']; ?>" alt="user"><span style="color:#428bca" class="name"><?php echo $value['chatter']; ?></span> - <span class="designation"><?php echo $value['status']; ?></span></p>
                          <small>Last Logged In: <?php echo $value['time']; ?></small>
                          <br><small>Profile Created : <?php echo $value['regdate']; ?></small>  
                            <br><small>Helped Others : <?php echo   Online_User_History("Select count(*) from tbl_app_chat where _frm = '". $value['session_id']."'"); ?> </small>  
                            <br><small><?php  echo AddFriend($value['session_id'],""); ?></small>  
             
                        </div>
                      </li>
                   <? } } ?>
                    </ul>
                  </div>
                </div>
              </div>
            </div>

            
          </div>
          

          

        </div>
      </div>
 
</body>